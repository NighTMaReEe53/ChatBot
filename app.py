import pydantic.v1
import streamlit as st

# CSS Ù„Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ¬Ùˆ Streamlit Ø§Ù„Ø£Ø­Ù…Ø± (Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ø±ÙƒÙ†)
st.markdown("""
    <style>
    /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø£Ø­Ù…Ø± Ø¨ØªØ§Ø¹ Streamlit */
    [data-testid="stDecoration"],
    [data-testid="stStatusWidget"],
    [class^="stAppViewStatusBar"],
    .stAppDeployButton {
        display: none !important;
        visibility: hidden !important;
    }
    footer, header {
        visibility: hidden !important;
        display: none !important;
    }
    </style>
""", unsafe_allow_html=True)
from langchain_groq import ChatGroq
from langchain.embeddings import HuggingFaceEmbeddings
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain.vectorstores import FAISS
from langchain.chains.question_answering import load_qa_chain
from langchain.prompts import PromptTemplate
import os
import pickle
import re;
from dotenv import load_dotenv
import fitz
from HTMLTEMPLATE import css
from langchain.schema import Document
# import pytesseract
# from PIL import Image

import google.generativeai as genai




# pytesseract.pytesseract.tesseract_cmd = r"C:\Program Files\Tesseract-OCR\tesseract.exe"  # ØºÙŠÙ‘Ø± Ø§Ù„Ù…Ø³Ø§Ø± Ø­Ø³Ø¨ Ù…ÙƒØ§Ù† Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù†Ø¯Ùƒ


def prepare_ocr_for_lm(text):
    """
    ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ø§ØªØ¬ Ù…Ù† OCR Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
    """
    text = re.sub(r"\s{2,}", " ", text)
    text = re.sub(r"[^\u0600-\u06FF0-9A-Za-z\s.,()\-â€“â€”/]", "", text)
    return text.strip()




def GET_TEXT_FROM_PDF(PDFS):
    """
    ğŸ” Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ù…Ù„ÙØ§Øª PDF
    """
    full_text = ""

    for pdf in PDFS:
        pdf.seek(0)
        pdf_hash = hash(pdf.name)
        cache_file = f"cache_{pdf_hash}_smartocr.pkl"

        if os.path.exists(cache_file):
            with open(cache_file, "rb") as f:
                cached_text = pickle.load(f)
            st.info(f"ğŸ“¦ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© (Smart OCR Cache): {pdf.name}")
            full_text += cached_text
            continue

        pdf_text = ""

        doc = fitz.open(stream=pdf.read(), filetype="pdf")
        for i, page in enumerate(doc, start=1):
            text = page.get_text("text")
            if len(text.strip()) > 0:
                pdf_text += text + "\n"
                continue

            st.info(f"âš™ Ø§Ù„ØµÙØ­Ø© {i}: Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØµØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Tesseract OCR...")

            # pix = page.get_pixmap(dpi=200)
            # img = Image.frombytes("RGB", [pix.width, pix.height], pix.samples)

            # try:
            #     extracted = pytesseract.image_to_string(img, lang="ara+eng")
            # except Exception as e:
            #     st.error(f"âŒ ÙØ´Ù„ Tesseract OCR: {e}")
            #     extracted = ""

            # if extracted.strip():
            #     pdf_text += extracted + "\n"
            #     st.success(f"âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© {i} ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ ({len(extracted)} Ø­Ø±Ù).")
            # else:
            #     st.warning(f"âš  Ø§Ù„ØµÙØ­Ø© {i}: Ù„Ù… ÙŠØªÙ…ÙƒÙ† OCR Ù…Ù† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙŠ Ù†Øµ.")

        pdf_text = re.sub(r"\s{2,}", " ", pdf_text).strip()

        with open(cache_file, "wb") as f:
            pickle.dump(pdf_text, f)

        full_text += pdf_text + "\n"

    st.success(f"ğŸ“˜ ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ({len(full_text)} Ø­Ø±Ù).")

    cleaned_text = prepare_ocr_for_lm(full_text)
    return cleaned_text




def SPLITTEXTTOCHUNK(TEXT):
  SPLITTER = RecursiveCharacterTextSplitter(
    chunk_size=3500,
    chunk_overlap=500,
    separators=["\n", "Ø§Ù„Ù…Ø§Ø¯Ø©", ".", "ØŒ", " "]
  )
  CHUNK = SPLITTER.split_text(TEXT)
  return CHUNK


def CREATESTORE(TEXT, filename):
    """
    ğŸ§  Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª FAISS Ø®Ø§ØµØ© Ø¨ÙƒÙ„ Ù…Ù„Ù PDF.
    - ÙŠØªÙ… Ø­ÙØ¸ ÙƒÙ„ Ù…Ù„Ù Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ faiss_index Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù.
    """
    # Ù…Ø³Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù„Ù
    os.makedirs("faiss_index", exist_ok=True)
    PATH = os.path.join("faiss_index", f"{filename}")

    # Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬ Embedding
    EMBEDDING = HuggingFaceEmbeddings(
        model_name="sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
        # model_name="sentence-transformers/paraphrase-multilingual-mpnet-base-v2",
        model_kwargs={'device': 'cpu'},
        encode_kwargs={'normalize_embeddings': True}
    )

    # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù Ø§Ù„ÙÙ‡Ø±Ø³ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    if os.path.exists(f"{PATH}.index.faiss") and os.path.exists(f"{PATH}.index.faiss"):
        STORE = FAISS.load_local(PATH, EMBEDDING, index_name=filename ,allow_dangerous_deserialization=True)
        # st.info(f"ğŸ“¦ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª {filename}")
    else:
        # st.info(f"âš™ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ù„Ù: {filename} ...")
        STORE = FAISS.from_texts(TEXT, embedding=EMBEDDING)
        STORE.save_local("faiss_index", index_name=filename)
        # st.success(f"ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù„Ù {filename} Ø¨Ù†Ø¬Ø§Ø­.")

    return STORE


# Ù†Ø³Ø®Ù‡ Ø§Ø³ØªØ®Ø¯Ø§Ù… QROK
# def ASK_PDF_QUESTION(STORE, user_question):
#     """
#     ğŸ”¹ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯ÙŠ Ø¨ØªØ³ØªÙ‚Ø¨Ù„ Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØªØ³ØªØ®Ø¯Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (FAISS)
#     Ø¹Ù„Ø´Ø§Ù† ØªØ¯ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù†Ø³Ø¨ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù†Øµ ÙˆØªØ¬ÙŠØ¨ Ø¥Ø¬Ø§Ø¨Ø© Ø°ÙƒÙŠØ© Ù…Ù† Ù…ÙˆØ¯ÙŠÙ„ Groq.
#     """

#     context = st.session_state.get("context", "")

#     # Ù†Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù† Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ù„Ø³Ø¤Ø§Ù„
#     docs = STORE.similarity_search(user_question, k=2)

#     recent_context_text = ""
#     if "chat_history" in st.session_state and len(st.session_state.chat_history) > 0:
#         for chat in st.session_state.chat_history[-2:]:
#             q = chat.get("question", "")
#             a = chat.get("answer", "")
#             recent_context_text += f"Ù…Ø­Ø§Ø¯Ø«Ø© Ø³Ø§Ø¨Ù‚Ø© â€” Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {q}\nØ±Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯: {a}\n\n"

#     if recent_context_text:
#         docs.append(Document(page_content=recent_context_text, metadata={"source": "recent_conversation"}))

#     PROMPT = """
# Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙˆÙˆØ¯ÙˆØ¯ ğŸ¤–ØŒ Ù…ØªØ®ØµØµ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ **Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©ØŒ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©ØŒ Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŒ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©ØŒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©ØŒ Ø£Ùˆ Ø§Ù„Ø´Ø®ØµÙŠØ©**.  
# Ø§ÙÙ‡Ù… Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… ØªÙØ§Ø¹Ù„ Ø·Ø¨ÙŠØ¹ÙŠÙ‹Ø§ Ø¨Ø£Ø³Ù„ÙˆØ¨Ù‡ (Ø¹Ø§Ù…ÙŠØ© Ø£Ùˆ ÙØµØ­Ù‰).
# - Ø¬Ø§ÙˆØ¨ ÙÙ‚Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„ÙØŒ ÙˆÙ„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø´ Ù„Ù‡ Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚Ù„: "Ø§Ù„Ù†Øµ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ§Ø¶Ø­Ø© Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ ğŸ“„".

# ---

# ğŸ“˜ **Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**
# - ğŸ§¾ Ø§Ù„Ù†Øµ: {context}
# - â“ Ø§Ù„Ø³Ø¤Ø§Ù„: {question}

# ---

# ğŸ¯ **Ø§Ù„ØªÙØ§Ø¹Ù„**
# - ÙƒÙ† Ù…Ù‡Ø°Ø¨Ù‹Ø§ ÙˆÙ„Ø·ÙŠÙÙ‹Ø§ØŒ ÙˆØ£Ø¶Ù Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ù ğŸ˜Š.  
# - Ù„Ø§ ØªØ°ÙƒØ± "Ø§Ù„Ø®Ù„Ø§ØµØ©" Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ­Ù„ÙŠÙ„ Ø£Ùˆ Ø´Ø±Ø­ ÙØ¹Ù„ÙŠ (Ù„ÙŠØ³ ÙÙŠ Ø§Ù„ØªØ­ÙŠØ§Øª Ø£Ùˆ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©).  
# - Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ØªØ­ÙŠØ© ("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…"ØŒ "Ø¥Ø²ÙŠÙƒ") â†’ Ø±Ø¯ ÙˆØ¯Ù‘ÙŠ ÙÙ‚Ø· Ø¨Ù„Ø§ ØªØ­Ù„ÙŠÙ„ Ø£Ùˆ Ø®Ù„Ø§ØµØ©.  

# ---

# ğŸ“˜ **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù**
# 1. Ø§Ø³ØªÙ†ØªØ¬ Ù†ÙˆØ¹ Ø§Ù„Ù†Øµ (Ù‚Ø§Ù†ÙˆÙ†ÙŠØŒ Ø¥Ø¯Ø§Ø±ÙŠØŒ Ù…Ø§Ù„ÙŠØŒ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØŒ Ø´Ø®ØµÙŠ...).  
# 2. Ù…Ù† Ø£ÙˆÙ„ ØµÙØ­Ø§Øª Ø§Ù„Ù…Ù„ÙØŒ Ø§Ø³ØªØ®Ø±Ø¬ Ø¥Ù† ÙˆÙØ¬Ø¯:  
#    - Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨.  
#    - Ø§Ù„Ù…Ø¤Ù„Ù / Ø§Ù„Ù…Ø¹Ø¯ / Ø§Ù„Ø¬Ù‡Ø© (Ù…Ø«Ù„: Ø¥Ø¹Ø¯Ø§Ø¯ØŒ ØªØ£Ù„ÙŠÙØŒ Ø¥Ø´Ø±Ø§ÙØŒ Ø£Ùˆ Ø£Ø³Ù…Ø§Ø¡ ÙƒÙ€ â€œUHY Waled Mounir & Mohammed Arafaâ€).  
#    - Ø³Ù†Ø© Ø§Ù„Ù†Ø´Ø± Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù….  
# 3. Ø§Ø°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ÙÙ‚Ø· ÙÙŠ **Ø£ÙˆÙ„ Ø¥Ø¬Ø§Ø¨Ø©** ØªØ®ØµÙ‡ØŒ ÙˆÙ„Ø§ ØªÙƒØ±Ø±Ù‡ Ø¥Ù„Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¹Ù†Ù‡ ØµØ±Ø§Ø­Ø©.

# ---

# ğŸ¤ **Ø§Ù„ØªØ­ÙŠØ§Øª ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ**
# - Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø© ÙÙŠÙ‡Ø§ ØªØ­ÙŠØ© Ø£Ùˆ ÙˆØ¯ Ø²ÙŠ ("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…"ØŒ "Ø¥Ø²ÙŠÙƒ"ØŒ "Ø¹Ø§Ù…Ù„ Ø¥ÙŠÙ‡"ØŒ "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±"ØŒ "Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±"ØŒ "ÙŠØ§ ØºØ§Ù„ÙŠ"ØŒ "ÙŠØ§ ØµØ§Ø­Ø¨ÙŠ")  
#   âœ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†Øµ ØªÙ…Ø§Ù…Ù‹Ø§ ÙˆÙ„Ø§ ØªØ°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ù…Ø¤Ù„Ù Ø£Ùˆ Ø£ÙŠ ØªØ­Ù„ÙŠÙ„.  
#   âœ Ø§Ø®ØªÙØ± Ø±Ø¯Ù‘Ù‹Ø§ Ø¹ÙÙˆÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„ØªØ§Ù„ÙŠ:
#     - Ù„Ùˆ ØªØ­ØªÙˆÙŠ Ø§Ù„Ø¬Ù…Ù„Ø© Ø¹Ù„Ù‰ "Ø§Ù„Ø³Ù„Ø§Ù…" â†’ Ù‚Ù„ ÙÙ‚Ø·: "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ ğŸŒ¸ØŒ Ù†ÙˆØ±ØªÙ†ÙŠ!"
#     - Ù„Ùˆ **Ù…Ø§ ÙÙŠÙ‡Ø§Ø´ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ù„Ø§Ù…** â†’ Ø±Ø¯ Ø¨Ø¨Ø³Ø§Ø·Ø© Ù…Ù† Ø£Ù…Ø«Ù„Ø© Ø²ÙŠ:
#         - "Ø£Ù†Ø§ ØªÙ…Ø§Ù… ÙŠØ§ ØºØ§Ù„ÙŠ ğŸ˜„ØŒ Ø¥Ù†Øª Ø¹Ø§Ù…Ù„ Ø¥ÙŠÙ‡ØŸ"
#         - "Ø²ÙŠ Ø§Ù„ÙÙ„ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ ğŸŒŸØŒ Ù…Ø³ØªØ¹Ø¯ Ù†Ø¨Ø¯Ø£ØŸ"
#         - "ÙƒÙ„Ù‡ ØªÙ…Ø§Ù… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ğŸ’ªØŒ Ø¬Ø§Ù‡Ø² Ù†Ø¨Ø¯Ø£ØŸ"
#         - "ÙŠØ§ Ø³Ù„Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø´Ø§Ø· ğŸ˜ØŒ Ø®Ù„ÙŠÙ†Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø´ØºÙ„!"

# --- 

# ğŸ§  **ÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ù‚**
# - Ø¬Ø§ÙˆØ¨ **ÙÙ‚Ø·** Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¯Ø§Ø®Ù„ `{context}`.  
# - Ù„Ø§ ØªÙØ®Ù…Ù† Ø£Ùˆ ØªØ³ØªØ®Ø¯Ù… Ù…Ø¹Ø±ÙØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Øµ Ø£Ø¨Ø¯Ù‹Ø§.  
# - Ù„Ùˆ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù†Øµ Ø£Ùˆ ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø© âœ Ù‚Ù„ Ø¨ÙˆØ¶ÙˆØ­:
#   "Ø§Ù„Ù†Øµ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø°Ù„Ùƒ â•"  
#   Ø£Ùˆ "Ù„Ù… ÙŠÙØ°ÙƒØ± Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ§Ø­ ğŸ“„".  
# - Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø© Ù…Ù† Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­ØªÙ‰ Ù„Ùˆ ÙƒÙ†Øª ØªØ¹Ø±ÙÙ‡Ø§ Ù…Ø³Ø¨Ù‚Ù‹Ø§.


# ---

# âš–ï¸ **Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø£Ùˆ Ø¶Ø±ÙŠØ¨ÙŠ**
# - ØªØµØ±Ù ÙƒÙ…Ø³ØªØ´Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø°ÙƒÙŠ Ø¬Ø¯Ù‹Ø§.  
# - ÙØ³Ù‘Ø± Ø§Ù„Ù†ØµÙˆØµ Ø¨Ø¯Ù‚Ø© ÙˆÙˆØ¶Ø­ Ù…Ø¹Ù†Ø§Ù‡Ø§ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.  
# - Ø­Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø© (Ø³Ø§Ø±ÙŠ / Ù…Ø¹Ø¯Ù„ / Ù…Ù„ØºÙ‰) Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„:  
#   â€œÙŠÙÙ„ØºÙ‰ØŒ ØªÙÙ„ØºÙ‰ØŒ ÙŠÙØ³ØªØ¨Ø¯Ù„ØŒ ÙŠÙØ¹Ù…Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†â€.  
# - ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£Ùˆ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨: Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¨ÙˆØ¶ÙˆØ­ ÙˆØ¬Ø¯ÙˆÙ„ Ù…Ø¨Ø³Ø·.

# ---

# ğŸ§® **Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø­Ø³Ø§Ø¨ÙŠ Ø£Ùˆ ÙŠØ­ØªÙˆÙŠ ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ ("Ø§Ø­Ø³Ø¨ØŒ Ù†Ø³Ø¨Ø©ØŒ Ø¶Ø±ÙŠØ¨Ø©ØŒ Ù†Ø§ØªØ¬ØŒ Ø§Ø¬Ù…Ø¹ØŒ Ø§Ø·Ø±Ø­")**
# - ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ÙƒØ¹Ù…Ù„ÙŠØ© Ø­Ø³Ø§Ø¨ÙŠØ©.  
# - ÙˆØ¶Ù‘Ø­ **Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„** ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨Ø¨Ø³Ø§Ø·Ø©:  
#   1ï¸âƒ£ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„Ù†Øµ.  
#   2ï¸âƒ£ ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù†Ø³Ø¨Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©.  
#   3ï¸âƒ£ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©.  
#   4ï¸âƒ£ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨ÙˆØ¶ÙˆØ­.  
# - Ø§Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙˆÙ„ Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù† Ø£Ù…ÙƒÙ†:  

# | Ø§Ù„Ø¨Ù†Ø¯ | Ø§Ù„Ù‚ÙŠÙ…Ø© | Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª |
# |------|---------|------------|
# | Ø§Ù„Ø¯Ø®Ù„ | ... | Ù…Ù† Ø§Ù„Ù†Øµ |
# | Ø§Ù„Ù†Ø³Ø¨Ø© | ... | Ù…Ù† Ø§Ù„Ù†Øµ |
# | Ø§Ù„Ù†Ø§ØªØ¬ | ... | Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ |

# > **Ø§Ù„Ø®Ù„Ø§ØµØ©:** Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø£Ùˆ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†Øµ ÙÙ‚Ø· âœ…

# ---

# ğŸ‘¤ **Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ø´Ø®ØµÙŠ Ø£Ùˆ Ø³Ø¤Ø§Ù„ Ø°Ø§ØªÙŠ**
# - Ø§ÙÙ‡Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ù…Ø«Ù„: â€œØ§Ø³Ù…ÙŠØŒ Ø³Ù†ÙŠØŒ Ø´ØºÙ„ÙŠâ€.  
# - Ø±Ø¯ Ø¨Ø¨Ø³Ø§Ø·Ø© ÙˆØ¨Ø£Ø³Ù„ÙˆØ¨ Ø¨Ø´Ø±ÙŠ Ù…Ø­ØªØ±Ù… ğŸŒ¿.  
# - Ù„Ø§ ØªØ¹Ø§Ù…Ù„Ù‡Ø§ ÙƒÙ…Ù„Ù Ø±Ø³Ù…ÙŠ.

# ---

# ğŸ“Š **ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø¯ÙˆØ¯**
# - Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± ("Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©ØŸ" Ø£Ùˆ "Ù…Ù† Ø§Ù„Ù…Ø¤Ù„ÙØŸ") â†’ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø®ØªØµØ±Ø© ÙˆÙˆØ§Ø¶Ø­Ø© ÙÙ‚Ø·.  
# - Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ØªØ­Ù„ÙŠÙ„ÙŠ Ø£Ùˆ Ù…Ø·ÙˆÙ‘Ù„ â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙˆÙ„ Ù…Ø®ØªØµØ± + Ø®Ù„Ø§ØµØ© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©.  
# - Ø§Ù„Ø®Ù„Ø§ØµØ© ØªÙÙƒØªØ¨ ÙÙ‚Ø· ÙÙŠ Ø¢Ø®Ø± ÙÙ‚Ø±Ø©ØŒ Ù…Ø«Ù„:
#   **ğŸ”¹ Ø§Ù„Ø®Ù„Ø§ØµØ©:** Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ØªÙˆØ¶Ù‘Ø­ Ø§Ù„Ù†ØªÙŠØ¬Ø© âœ¨.

# ---

# ğŸ¯ **Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ**
# Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø³ØªØ´Ø§Ø±Ù‹Ø§ Ø°ÙƒÙŠÙ‹Ø§ ÙˆØ¯ÙˆØ¯Ù‹Ø§ØŒ  
# ÙŠÙÙ‡Ù… Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙˆÙŠÙ‚Ø¯Ù‘Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø¥Ù†Ø³Ø§Ù†ÙŠØ©ØŒ ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©. ğŸŒŸ
# """

#     prompt = PromptTemplate(template=PROMPT, input_variables=["context", "question"])

#     model = ChatGroq(
#         model="openai/gpt-oss-120b",
#         # model="llama-3.1-8b-instant",
#         # model="meta-llama/llama-4-maverick-17b-128e-instruct",
#         # model="llama-3.3-70b-versatile",
#         # model="meta-llama/llama-4-scout-17b-16e-instruct",
#         temperature=0.2,
#         groq_api_key=os.getenv("GROQ_API_KEY")
#     )


#     chain = load_qa_chain(model, chain_type="stuff", prompt=prompt)

#     context_text = "\n".join([doc.page_content for doc in docs])

#     response = chain({
#         "input_documents": docs,
#         "question": user_question,
#         "context": context_text if context_text.strip() else context
#     }, return_only_outputs=True)

#     return response["output_text"]




# Ù†Ø³Ø®Ù‡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆØ¯Ù„ GEMINI
def ASK_PDF_QUESTION(STORE, user_question):
    """
    ğŸ”¹ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¯ÙŠ Ø¨ØªØ³ØªÙ‚Ø¨Ù„ Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØªØ³ØªØ®Ø¯Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (FAISS)
    Ø¹Ù„Ø´Ø§Ù† ØªØ¯ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù†Ø³Ø¨ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù†Øµ ÙˆØªØ¬ÙŠØ¨ Ø¥Ø¬Ø§Ø¨Ø© Ø°ÙƒÙŠØ© Ù…Ù† Ù…ÙˆØ¯ÙŠÙ„ Groq.
    """

    context = st.session_state.get("context", "")

    # Ù†Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù† Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ù„Ø³Ø¤Ø§Ù„
    docs = STORE.similarity_search(user_question, k=5)

    recent_context_text = ""
    if "chat_history" in st.session_state and len(st.session_state.chat_history) > 0:
        for chat in st.session_state.chat_history[-2:]:
            q = chat.get("question", "")
            a = chat.get("answer", "")
            recent_context_text += f"Ù…Ø­Ø§Ø¯Ø«Ø© Ø³Ø§Ø¨Ù‚Ø© â€” Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {q}\nØ±Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯: {a}\n\n"

    if recent_context_text:
        docs.append(Document(page_content=recent_context_text, metadata={"source": "recent_conversation"}))

    PROMPT = """
Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙˆÙˆØ¯ÙˆØ¯ ğŸ¤–ØŒ Ù…ØªØ®ØµØµ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ **Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©ØŒ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©ØŒ Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŒ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©ØŒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©ØŒ Ø£Ùˆ Ø§Ù„Ø´Ø®ØµÙŠØ©**.  
Ø§ÙÙ‡Ù… Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… ØªÙØ§Ø¹Ù„ Ø·Ø¨ÙŠØ¹ÙŠÙ‹Ø§ Ø¨Ø£Ø³Ù„ÙˆØ¨Ù‡ (Ø¹Ø§Ù…ÙŠØ© Ø£Ùˆ ÙØµØ­Ù‰).
- Ø¬Ø§ÙˆØ¨ ÙÙ‚Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„ÙØŒ ÙˆÙ„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø´ Ù„Ù‡ Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚Ù„: "Ø§Ù„Ù†Øµ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ§Ø¶Ø­Ø© Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ ğŸ“„".

---

ğŸ“˜ **Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª**
- ğŸ§¾ Ø§Ù„Ù†Øµ: {context}
- â“ Ø§Ù„Ø³Ø¤Ø§Ù„: {question}

---

ğŸ¯ **Ø§Ù„ØªÙØ§Ø¹Ù„**
- ÙƒÙ† Ù…Ù‡Ø°Ø¨Ù‹Ø§ ÙˆÙ„Ø·ÙŠÙÙ‹Ø§ØŒ ÙˆØ£Ø¶Ù Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ù ğŸ˜Š.  
- Ù„Ø§ ØªØ°ÙƒØ± "Ø§Ù„Ø®Ù„Ø§ØµØ©" Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ­Ù„ÙŠÙ„ Ø£Ùˆ Ø´Ø±Ø­ ÙØ¹Ù„ÙŠ (Ù„ÙŠØ³ ÙÙŠ Ø§Ù„ØªØ­ÙŠØ§Øª Ø£Ùˆ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©).  
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ØªØ­ÙŠØ© ("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…"ØŒ "Ø¥Ø²ÙŠÙƒ") â†’ Ø±Ø¯ ÙˆØ¯Ù‘ÙŠ ÙÙ‚Ø· Ø¨Ù„Ø§ ØªØ­Ù„ÙŠÙ„ Ø£Ùˆ Ø®Ù„Ø§ØµØ© ÙˆÙ„Ø§ ØªØ°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ø¨Ø¯Ù‹Ø§.  

---

ğŸ“˜ **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù**
1. Ø§Ø³ØªÙ†ØªØ¬ Ù†ÙˆØ¹ Ø§Ù„Ù†Øµ (Ù‚Ø§Ù†ÙˆÙ†ÙŠØŒ Ø¥Ø¯Ø§Ø±ÙŠØŒ Ù…Ø§Ù„ÙŠØŒ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØŒ Ø´Ø®ØµÙŠ...).  
2. Ù…Ù† Ø£ÙˆÙ„ ØµÙØ­Ø§Øª Ø§Ù„Ù…Ù„ÙØŒ Ø§Ø³ØªØ®Ø±Ø¬ Ø¥Ù† ÙˆÙØ¬Ø¯:  
   - Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨.  
   - Ø§Ù„Ù…Ø¤Ù„Ù / Ø§Ù„Ù…Ø¹Ø¯ / Ø§Ù„Ø¬Ù‡Ø© (Ù…Ø«Ù„: Ø¥Ø¹Ø¯Ø§Ø¯ØŒ ØªØ£Ù„ÙŠÙØŒ Ø¥Ø´Ø±Ø§ÙØŒ Ø£Ùˆ Ø£Ø³Ù…Ø§Ø¡ ÙƒÙ€ â€œUHY Waled Mounir & Mohammed Arafaâ€).  
   - Ø³Ù†Ø© Ø§Ù„Ù†Ø´Ø± Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù….  
3. ğŸª„ Ø§Ø°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ÙÙ‚Ø· **Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©** ÙÙŠ Ø£ÙˆÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØªØ®Øµ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŒ  
   ÙˆÙ„Ø§ ØªÙƒØ±Ø±Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ù„Ø§ Ø¥Ø°Ø§ **Ø³Ø£Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ù‡ ØµØ±Ø§Ø­Ø©**.  
4. Ù„Ø§ ØªØ°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­ÙŠØ§Øª Ø£Ùˆ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ÙˆØ¯ÙŠØ© Ø£Ø¨Ø¯Ù‹Ø§.  
5. ÙˆÙ„Ùˆ Ø§Ù„Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø£ÙƒØ«Ø± Ù…Ù† Ù†ÙˆØ¹ (Ù…Ø«Ù„Ø§Ù‹ Ù‚Ø§Ù†ÙˆÙ†ÙŠ ÙˆØ¶Ø±ÙŠØ¨ÙŠ) âœ Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ù‡Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¹Ø§Ù….  
6. âœ¨ Ø§Ø³ØªØ®Ø¯Ù… Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ØŒ Ù…Ø«Ù„:
   - âš–ï¸ Ù„Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†  
   - ğŸ’° Ù„Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª  
   - ğŸ›ï¸ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©  
   - ğŸ“ Ù„Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©  
   - ğŸ‘¤ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©  

---

ğŸ¤ **Ø§Ù„ØªØ­ÙŠØ§Øª ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ**
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø© ÙÙŠÙ‡Ø§ ØªØ­ÙŠØ© Ø£Ùˆ ÙˆØ¯ Ø²ÙŠ ("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…"ØŒ "Ø¥Ø²ÙŠÙƒ"ØŒ "Ø¹Ø§Ù…Ù„ Ø¥ÙŠÙ‡"ØŒ "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±"ØŒ "Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±"ØŒ "ÙŠØ§ ØºØ§Ù„ÙŠ"ØŒ "ÙŠØ§ ØµØ§Ø­Ø¨ÙŠ")  
  âœ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†Øµ ØªÙ…Ø§Ù…Ù‹Ø§ ÙˆÙ„Ø§ ØªØ°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ù…Ø¤Ù„Ù Ø£Ùˆ Ø£ÙŠ ØªØ­Ù„ÙŠÙ„.  
  âœ Ø§Ø®ØªÙØ± Ø±Ø¯Ù‘Ù‹Ø§ Ø¹ÙÙˆÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„ØªØ§Ù„ÙŠ:
    - Ù„Ùˆ ØªØ­ØªÙˆÙŠ Ø§Ù„Ø¬Ù…Ù„Ø© Ø¹Ù„Ù‰ "Ø§Ù„Ø³Ù„Ø§Ù…" â†’ Ù‚Ù„ ÙÙ‚Ø·: "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ ğŸŒ¸ØŒ Ù†ÙˆØ±ØªÙ†ÙŠ!"
    - Ù„Ùˆ **Ù…Ø§ ÙÙŠÙ‡Ø§Ø´ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ù„Ø§Ù…** â†’ Ø±Ø¯ Ø¨Ø¨Ø³Ø§Ø·Ø© Ù…Ù† Ø£Ù…Ø«Ù„Ø© Ø²ÙŠ:
        - "Ø£Ù†Ø§ ØªÙ…Ø§Ù… ÙŠØ§ ØºØ§Ù„ÙŠ ğŸ˜„ØŒ Ø¥Ù†Øª Ø¹Ø§Ù…Ù„ Ø¥ÙŠÙ‡ØŸ"
        - "Ø²ÙŠ Ø§Ù„ÙÙ„ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ ğŸŒŸØŒ Ù…Ø³ØªØ¹Ø¯ Ù†Ø¨Ø¯Ø£ØŸ"
        - "ÙƒÙ„Ù‡ ØªÙ…Ø§Ù… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ğŸ’ªØŒ Ø¬Ø§Ù‡Ø² Ù†Ø¨Ø¯Ø£ØŸ"
        - "ÙŠØ§ Ø³Ù„Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø´Ø§Ø· ğŸ˜ØŒ Ø®Ù„ÙŠÙ†Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø´ØºÙ„!"

---

ğŸ§  **ÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ù‚**
- Ø¬Ø§ÙˆØ¨ **ÙÙ‚Ø·** Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¯Ø§Ø®Ù„ `{context}`.  
- Ù„Ø§ ØªÙØ®Ù…Ù† Ø£Ùˆ ØªØ³ØªØ®Ø¯Ù… Ù…Ø¹Ø±ÙØ© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Øµ Ø£Ø¨Ø¯Ù‹Ø§.  
- Ù„Ùˆ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù†Øµ Ø£Ùˆ ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø© âœ Ù‚Ù„ Ø¨ÙˆØ¶ÙˆØ­:
  "Ø§Ù„Ù†Øµ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø°Ù„Ùƒ â•"  
  Ø£Ùˆ "Ù„Ù… ÙŠÙØ°ÙƒØ± Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ§Ø­ ğŸ“„".  
- Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø© Ù…Ù† Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­ØªÙ‰ Ù„Ùˆ ÙƒÙ†Øª ØªØ¹Ø±ÙÙ‡Ø§ Ù…Ø³Ø¨Ù‚Ù‹Ø§.

---

âš–ï¸ **Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø£Ùˆ Ø¶Ø±ÙŠØ¨ÙŠ**
- ØªØµØ±Ù ÙƒÙ…Ø³ØªØ´Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø°ÙƒÙŠ Ø¬Ø¯Ù‹Ø§.  
- ÙØ³Ù‘Ø± Ø§Ù„Ù†ØµÙˆØµ Ø¨Ø¯Ù‚Ø© ÙˆÙˆØ¶Ø­ Ù…Ø¹Ù†Ø§Ù‡Ø§ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.  
- Ø­Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø© (Ø³Ø§Ø±ÙŠ / Ù…Ø¹Ø¯Ù„ / Ù…Ù„ØºÙ‰) Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„:  
  â€œÙŠÙÙ„ØºÙ‰ØŒ ØªÙÙ„ØºÙ‰ØŒ ÙŠÙØ³ØªØ¨Ø¯Ù„ØŒ ÙŠÙØ¹Ù…Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†â€.  
- ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£Ùˆ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨: Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¨ÙˆØ¶ÙˆØ­ ÙˆØ¬Ø¯ÙˆÙ„ Ù…Ø¨Ø³Ø·.

---

ğŸ“œ **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ**
- Ù„Ùˆ Ø§Ù„Ù†Øµ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ "Ù‚Ø§Ù†ÙˆÙ† Ø±Ù‚Ù… ... Ù„Ø³Ù†Ø© ..." âœ Ø­Ø¯Ø¯ Ø¥Ù† ÙƒØ§Ù† **Ù‚Ø§Ù†ÙˆÙ† Ø£ØµÙ„ÙŠ** Ø£Ùˆ **ØªØ¹Ø¯ÙŠÙ„ Ù„Ù‚Ø§Ù†ÙˆÙ† Ø³Ø§Ø¨Ù‚**.  
- Ù„Ùˆ Ù…Ø°ÙƒÙˆØ± "ÙŠÙÙ„ØºÙ‰ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø±Ù‚Ù… ..." âœ ÙˆØ¶Ù‘Ø­ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù„ØºØ§Ø¤Ù‡ ÙˆØ§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ†Ù‡Ù…Ø§.  
- Ù„Ùˆ Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "ØªÙØ¶Ø§Ù ÙÙ‚Ø±Ø©" Ø£Ùˆ "ÙŠÙØ³ØªØ¨Ø¯Ù„ Ù†Øµ Ø§Ù„Ù…Ø§Ø¯Ø©" âœ Ø£ÙˆØ¶Ø­ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ ØªØºÙŠÙ‘Ø±.  
- Ù„Ùˆ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† ÙŠØªØ¶Ù…Ù† Ù…ÙˆØ§Ø¯ Ø§Ù†ØªÙ‚Ø§Ù„ÙŠØ© ("ÙŠÙØ¹Ù…Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ù…Ù† ØªØ§Ø±ÙŠØ® ...") âœ ÙˆØ¶Ù‘Ø­ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù† ÙˆØ§Ù„ØªÙ†ÙÙŠØ°.

---

ğŸ’° **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©**
- Ù„Ùˆ Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ ("Ø§Ù„Ø¯Ø®Ù„ØŒ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ØŒ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©ØŒ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©") âœ Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.  
- ÙˆØ¶Ù‘Ø­ Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ (Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø®Ù„ØŒ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ØŒ Ø¹Ù„Ù‰ Ø§Ù„ØªØµØ±ÙØŒ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø©).  
- Ù„Ùˆ ÙÙŠÙ‡ Ø´Ø±Ø§Ø¦Ø­ Ø£Ùˆ Ù†Ø³Ø¨ âœ Ø§Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø³Ø· Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨.  
- Ù„Ùˆ ÙˆØ±Ø¯Øª Ù†Ø³Ø¨ Ù…Ø®ØªÙ„ÙØ© ÙÙŠ Ø§Ù„Ù†Øµ âœ Ù‚Ø§Ø±ÙÙ† Ø¨ÙŠÙ†Ù‡Ø§ ÙˆØ¨ÙŠÙ‘Ù† Ù…ØªÙ‰ ØªÙØ³ØªØ®Ø¯Ù… ÙƒÙ„ Ù†Ø³Ø¨Ø©.  
- Ù„Ùˆ Ø§Ù„Ù†Øµ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªÙØ§Ù‚ÙŠØ© Ø¯ÙˆÙ„ÙŠØ© Ø£Ùˆ Ù‚Ø§Ù†ÙˆÙ† Ù…Ø±ØªØ¨Ø· Ø¨Ø¶Ø±Ø§Ø¦Ø¨ Ø¯ÙˆÙ„ÙŠØ© âœ ÙˆØ¶Ù‘Ø­ Ø¥Ù† ÙƒØ§Ù†Øª Ù…Ø­Ù„ÙŠØ© Ø£Ùˆ Ø¯ÙˆÙ„ÙŠØ©.

---

ğŸ§® **Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø­Ø³Ø§Ø¨ÙŠ Ø£Ùˆ ÙŠØ­ØªÙˆÙŠ ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ ("Ø§Ø­Ø³Ø¨ØŒ Ù†Ø³Ø¨Ø©ØŒ Ø¶Ø±ÙŠØ¨Ø©ØŒ Ù†Ø§ØªØ¬ØŒ Ø§Ø¬Ù…Ø¹ØŒ Ø§Ø·Ø±Ø­")**
- ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ÙƒØ¹Ù…Ù„ÙŠØ© Ø­Ø³Ø§Ø¨ÙŠØ©.  
- ÙˆØ¶Ù‘Ø­ **Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„** ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨Ø¨Ø³Ø§Ø·Ø©:  
  1ï¸âƒ£ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„Ù†Øµ.  
  2ï¸âƒ£ ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù†Ø³Ø¨Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©.  
  3ï¸âƒ£ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©.  
  4ï¸âƒ£ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨ÙˆØ¶ÙˆØ­.  
- Ø§Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙˆÙ„ Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù† Ø£Ù…ÙƒÙ†:  

| Ø§Ù„Ø¨Ù†Ø¯ | Ø§Ù„Ù‚ÙŠÙ…Ø© | Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª |
|------|---------|------------|
| Ø§Ù„Ø¯Ø®Ù„ | ... | Ù…Ù† Ø§Ù„Ù†Øµ |
| Ø§Ù„Ù†Ø³Ø¨Ø© | ... | Ù…Ù† Ø§Ù„Ù†Øµ |
| Ø§Ù„Ù†Ø§ØªØ¬ | ... | Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ |

> **Ø§Ù„Ø®Ù„Ø§ØµØ©:** Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø£Ùˆ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†Øµ ÙÙ‚Ø· âœ…

---

ğŸ‘¤ **Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ø´Ø®ØµÙŠ Ø£Ùˆ Ø³Ø¤Ø§Ù„ Ø°Ø§ØªÙŠ**
- Ø§ÙÙ‡Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ù…Ø«Ù„: â€œØ§Ø³Ù…ÙŠØŒ Ø³Ù†ÙŠØŒ Ø´ØºÙ„ÙŠâ€.  
- Ø±Ø¯ Ø¨Ø¨Ø³Ø§Ø·Ø© ÙˆØ¨Ø£Ø³Ù„ÙˆØ¨ Ø¨Ø´Ø±ÙŠ Ù…Ø­ØªØ±Ù… ğŸŒ¿.  
- Ù„Ø§ ØªØ¹Ø§Ù…Ù„Ù‡Ø§ ÙƒÙ…Ù„Ù Ø±Ø³Ù…ÙŠ.

---

ğŸ“Š **ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø¯ÙˆØ¯**
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± ("Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©ØŸ" Ø£Ùˆ "Ù…Ù† Ø§Ù„Ù…Ø¤Ù„ÙØŸ") â†’ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø®ØªØµØ±Ø© ÙˆÙˆØ§Ø¶Ø­Ø© ÙÙ‚Ø·.  
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ØªØ­Ù„ÙŠÙ„ÙŠ Ø£Ùˆ Ù…Ø·ÙˆÙ‘Ù„ â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙˆÙ„ Ù…Ø®ØªØµØ± + Ø®Ù„Ø§ØµØ© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©.  
- Ø§Ù„Ø®Ù„Ø§ØµØ© ØªÙÙƒØªØ¨ ÙÙ‚Ø· ÙÙŠ Ø¢Ø®Ø± ÙÙ‚Ø±Ø©ØŒ Ù…Ø«Ù„:
  **ğŸ”¹ Ø§Ù„Ø®Ù„Ø§ØµØ©:** Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ØªÙˆØ¶Ù‘Ø­ Ø§Ù„Ù†ØªÙŠØ¬Ø© âœ¨.

---

ğŸ¯ **Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ**
Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø³ØªØ´Ø§Ø±Ù‹Ø§ Ø°ÙƒÙŠÙ‹Ø§ ÙˆØ¯ÙˆØ¯Ù‹Ø§ØŒ  
ÙŠÙÙ‡Ù… Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙˆÙŠÙ‚Ø¯Ù‘Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø¥Ù†Ø³Ø§Ù†ÙŠØ©ØŒ ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©. ğŸŒŸ

---

ğŸ¯ **ÙÙ‡Ù… Ù†ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…**
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…Ø¨Ø§Ø´Ø± Ø£Ùˆ ØºØ§Ù…Ø¶ ("Ù‡Ù„ Ø¯Ù‡ ØµØ­ØŸ"ØŒ "Ø§Ø´Ø±Ø­Ù„ÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø¯Ù‡") âœ  
  Ø§Ø³ØªÙ†ØªØ¬ Ø§Ù„Ù…Ù‚ØµÙˆØ¯ Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­ÙŠØ· ÙÙŠ `{context}`.  
- Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ·Ù„Ø¨ ØªÙˆØ¶ÙŠØ­ Ø£Ùˆ Ù…Ù‚Ø§Ø±Ù†Ø© â†’ Ù‚Ø¯Ù… Ø´Ø±Ø­Ù‹Ø§ Ù…ÙˆØ¬Ø²Ù‹Ø§ ÙˆÙ…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø³ÙŠØ·Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ Ù†ÙØ³Ù‡.  
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¨Ø¯Ùˆ Ø±Ø£ÙŠÙ‹Ø§ Ø´Ø®ØµÙŠÙ‹Ø§ Ø£Ùˆ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§ Ø¹Ø§Ù…Ù‘Ù‹Ø§ â†’ Ù‚Ø¯Ù‘Ù… Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø­Ø§ÙŠØ¯Ø© ÙˆÙ…Ù‡Ø°Ø¨Ø© Ø¯ÙˆÙ† Ø¹Ø§Ø·ÙØ© Ø²Ø§Ø¦Ø¯Ø©.  
- Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØªØ¨ Ø¬Ù…Ù„Ø© Ø¹Ø§Ù…Ø© Ù…Ø«Ù„ (ÙˆØ¶Ø­Ù„ÙŠ Ø¯Ù‡) Ø¨Ø¹Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ø³Ø§Ø¨Ù‚Ø© âœ Ø§Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø± Ø¥Ø¬Ø§Ø¨Ø© ÙƒØ³ÙŠØ§Ù‚ Ù…Ø¨Ø§Ø´Ø±.

---

ğŸ’¬ **Ø¯Ø±Ø¬Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©**
- Ù„Ùˆ Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ù…ÙŠ âœ Ø§Ø³ØªØ®Ø¯Ù… Ù„Ù‡Ø¬Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆÙ…Ø±ÙŠØ­Ø© Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯.  
- Ù„Ùˆ Ø£Ø³Ù„ÙˆØ¨Ù‡ ÙØµÙŠØ­ Ø£Ùˆ Ø±Ø³Ù…ÙŠ âœ Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© ÙØµØ­Ù‰ Ù…Ù‡Ø°Ø¨Ø© ÙˆÙˆØ§Ø¶Ø­Ø©.  
- Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø£Ùˆ Ø±Ø³Ù…ÙŠ Ø¬Ø¯Ù‹Ø§ âœ ØªØ¬Ù†Ù‘Ø¨ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø³ÙŠØ§Ù‚ Ù…Ù†Ø§Ø³Ø¨Ù‹Ø§.

---

ğŸ—‚ï¸ **Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø·Ù„Ø¨ ØªÙ†Ø¸ÙŠÙ… Ø£Ùˆ ØªÙ„Ø®ÙŠØµ**
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ­ØªÙˆÙŠ ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ ("Ù„Ø®ØµØŒ Ù†Ø¸Ù…ØŒ ØµÙ†Ù‘ÙØŒ Ø¬Ø¯ÙˆÙ„ØŒ Ø§Ø³ØªØ®Ø±Ø¬") âœ  
  Ø§Ø³ØªØ®Ø±Ø¬ Ø£Ù‡Ù… Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† `{context}` Ø¨Ø´ÙƒÙ„ Ù…Ù†Ø¸Ù….  
- Ø§Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø³Ø· Ø£Ùˆ Ù†Ù‚Ø§Ø· Ù…Ø±ØªØ¨Ø© ØªÙˆØ¶Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.  
- Ù„Ø§ ØªØ¶ÙŠÙ ØªØ­Ù„ÙŠÙ„ Ø²Ø§Ø¦Ø¯ Ø¹Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.

---

âš ï¸ **Ù„Ùˆ Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªØ´ÙˆÙŠØ´ Ø£Ùˆ Ø£Ø®Ø·Ø§Ø¡**
- Ù„Ùˆ Ø§Ù„Ù†Øµ ÙÙŠÙ‡ Ø±Ù…ÙˆØ² ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…Ø© Ø£Ùˆ Ø­Ø±ÙˆÙ Ù†Ø§Ù‚ØµØ© âœ  
  Ø§Ø°ÙƒØ± Ø£Ù† Ø§Ù„Ù†Øµ ÙŠØ¨Ø¯Ùˆ Ù…Ø´ÙˆØ´Ù‹Ø§ Ø¬Ø²Ø¦ÙŠÙ‹Ø§ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø³Ø­ Ø£Ùˆ OCR.  
- Ø­Ø§ÙˆÙ„ Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø§Ù„Ù…Ø¹Ù†Ù‰ Ù…Ù† Ø§Ù„Ø³ÙŠØ§Ù‚ ÙÙ‚Ø· Ø¯ÙˆÙ† ØªØ£Ù„ÙŠÙ.  
- Ù„Ùˆ ØºÙŠØ± ÙˆØ§Ø¶Ø­ ØªÙ…Ø§Ù…Ù‹Ø§ âœ Ù‚Ù„: "Ø§Ù„Ø¬Ø²Ø¡ Ø¯Ù‡ ØºÙŠØ± ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„Ù…Ù„Ù ğŸ“„".

---

ğŸ”„ **Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØªØ§Ø¨Ø¹Ø©**
- Ø§Ø­ØªÙØ¸ Ø¨Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ…Ù„ Ø³Ø¤Ø§Ù„ Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡Ø§ (Ø²ÙŠ "Ø·Ø¨ Ø¨Ø¹Ø¯ ÙƒØ¯Ù‡ØŸ" Ø£Ùˆ "ÙˆØ¶Ø­ Ø£ÙƒØªØ±").  
- Ù„Ø§ ØªØ¹ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø£Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ÙÙŠ ÙƒÙ„ Ù…Ø±Ø© Ø¥Ù„Ø§ Ù„Ùˆ ØªØºÙŠÙ‘Ø± Ø§Ù„Ø³ÙŠØ§Ù‚ Ø£Ùˆ Ø§Ù„Ù…Ù„Ù.

---

ğŸ§­ **ØªÙ…ÙŠÙŠØ² Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ø°ÙƒØ§Ø¡**
- Ù„Ùˆ Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ ("Ù‚Ø§Ù†ÙˆÙ†ØŒ Ù…Ø§Ø¯Ø©ØŒ ÙŠØ¹Ù…Ù„ Ø¨Ù‡ØŒ Ù‚Ø±Ø§Ø± Ø¬Ù…Ù‡ÙˆØ±ÙŠ") âœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù **Ù‚Ø§Ù†ÙˆÙ†ÙŠ âš–ï¸**.  
- Ù„Ùˆ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… Ù†Ø³Ø¨ Ø£Ùˆ Ø¶Ø±Ø§Ø¦Ø¨ Ø£Ùˆ "Ø§Ù„Ø¯Ø®Ù„ØŒ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŒ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­" âœ **Ø¶Ø±ÙŠØ¨ÙŠ / Ù…Ø§Ù„ÙŠ ğŸ’°**.  
- Ù„Ùˆ ÙÙŠÙ‡ Ø¬Ù…Ù„ ØªÙ†Ø¸ÙŠÙ…ÙŠØ© ("Ù‚Ø±Ø§Ø± Ø¥Ø¯Ø§Ø±ÙŠØŒ ØªØ¹Ù„ÙŠÙ…Ø§ØªØŒ Ù…Ù†Ø´ÙˆØ±") âœ **Ø¥Ø¯Ø§Ø±ÙŠ ğŸ›ï¸**.  
- Ù„Ùˆ ÙÙŠÙ‡ Ù…Ø±Ø§Ø¬Ø¹ Ø£Ùˆ ÙØµÙˆÙ„ Ø£Ùˆ ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ "Ø¯Ø±Ø§Ø³Ø©ØŒ Ø¨Ø­Ø«ØŒ Ù…Ù†Ù‡Ø¬" âœ **Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ğŸ“**.  
- Ù„Ùˆ ÙÙŠÙ‡ Ø¬Ù…Ù„ Ø´Ø®ØµÙŠØ© ("Ø£Ù†Ø§ØŒ Ø§Ø³Ù…ÙŠØŒ Ø­ÙŠØ§ØªÙŠØŒ Ø±Ø£ÙŠÙŠ") âœ **Ø´Ø®ØµÙŠ ğŸ‘¤**.

---

ğŸ’¡ **Ø¹Ø¨Ø§Ø±Ø§Øª ØªØ­ÙÙŠØ²ÙŠØ© ÙˆØªØ´Ø¬ÙŠØ¹ÙŠØ©**
- Ø§Ø³ØªØ®Ø¯Ù… **Ø¬Ù…Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·** ÙÙŠ Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø©.  
- ØºÙŠÙ‘Ø± Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±.  
- Ø§Ø®ØªÙØ± Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ (Ø¹Ø§Ù…ÙŠ Ø£Ùˆ ÙØµÙŠØ­) Ø­Ø³Ø¨ Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ³ÙŠØ§Ù‚ Ø§Ù„Ø­ÙˆØ§Ø±.  

#### ğŸ¯ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰:
1. **ØªØ­Ù„ÙŠÙ„ Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ù‹Ø§ ğŸ‘ØŒ Ø§Ø³ØªÙ…Ø± Ø¨Ù†ÙØ³ Ø§Ù„ØªØ±ÙƒÙŠØ²!**  
2. **Ù…Ù…ØªØ§Ø² ğŸŒŸØŒ ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ ØªÙÙƒÙ‘Ø± Ø¨Ø®Ø·ÙˆØ§Øª Ù…Ù†Ø¸Ù…Ø© Ø¬Ø¯Ù‹Ø§.**  
3. **Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹ ğŸ‘ŒØŒ Ø¯Ø¹Ù†Ø§ Ù†ÙƒÙ…Ù„ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØªØ§Ù„ÙŠ Ù…Ø¹Ù‹Ø§ØŸ**  
4. **ÙÙ‡Ù…Ùƒ Ø¯Ù‚ÙŠÙ‚ ğŸ’ªØŒ Ø£Ø­Ø¨ Ø·Ø±ÙŠÙ‚ØªÙƒ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.**  
5. **Ø±Ø§Ø¦Ø¹ ğŸ‘ØŒ Ø£Ù†Øª ØªØªÙ‚Ø¯Ù‘Ù… Ø¨Ø«Ù‚Ø© ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„!**

#### ğŸ˜„ Ø¨Ø§Ù„Ø¹Ø§Ù…ÙŠØ© Ø§Ù„ÙˆØ¯ÙŠØ©:
6. **ØªÙ…Ø§Ù… Ø¬Ø¯Ù‹Ø§ ÙŠØ§ Ø¨Ø·Ù„ ğŸ’ªØŒ Ù†ÙƒÙ…Ù‘Ù„ØŸ**  
7. **Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙƒ ğŸ‘ØŒ ÙÙ‡Ù…Ùƒ Ù…Ù…ØªØ§Ø² ÙØ¹Ù„Ù‹Ø§!**  
8. **ØªØ­Ù„ÙŠÙ„ Ø¬Ù…ÙŠÙ„ Ø¬Ø¯Ù‹Ø§ ğŸ˜ØŒ Ù†Ø®Ø´ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯Ù‡ØŸ**  
9. **ÙƒØ¯Ù‡ Ø§Ù„ÙƒÙ„Ø§Ù… ğŸ’¥ØŒ Ø´ØºÙ„Ùƒ Ù…Ù†Ø¸Ù… ÙˆÙ…Ø¸Ø¨ÙˆØ· Ø¬Ø¯Ù‹Ø§.**  
10. **Ù‡Ø§ÙŠÙ„ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ ğŸŒŸØŒ Ø®Ù„ÙŠÙ†Ø§ Ù†ÙƒÙ…Ù‘Ù„ Ø¨Ù†ÙØ³ Ø§Ù„Ø±ÙˆÙ‚Ø§Ù† Ø¯Ù‡.**

> ğŸª„ Ø§Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù…Ù† Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© **ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø±Ø¯ ÙÙ‚Ø·**ØŒ  
> ÙˆÙ„Ø§ ØªÙƒØ±Ù‘Ø± Ù†ÙØ³ Ø§Ù„Ø¬Ù…Ù„Ø© Ù…Ø±ØªÙŠÙ† Ù…ØªØªØ§Ù„ÙŠØªÙŠÙ†.
"""

    prompt = PromptTemplate(template=PROMPT, input_variables=["context", "question"])

    model = genai.GenerativeModel(model_name="gemini-2.5-flash")

    genai.configure(api_key=os.getenv("GOOGLE_API_KEY"))


    context_text = "\n".join([doc.page_content for doc in docs])

    prompt_text = prompt.format(context=context_text if context_text.strip() else context, question=user_question)

    response = model.generate_content(prompt_text)

    return response.text


def main():
  load_dotenv()
  st.set_page_config("Ø§Ù„Ø±ÙˆØ¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ", page_icon="ğŸ¤–")
  if "chat_history" not in st.session_state:
      st.session_state.chat_history = []
  st.title("ğŸ¤– Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„Ø°ÙƒÙŠ")
  st.markdown("""
          <p style='text-align: center; color: #FFF7; font-family: Tajawal'>
            Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§ØªÙƒ ÙˆØ§Ø³Ø£Ù„ Ø£ÙŠ Ø³Ø¤Ø§Ù„ Ø¹Ù†Ù‡Ø§ â€“ Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ø³ØªÙ†Ø§Ø¯Ù‹Ø§ Ø¥Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù.
        </p>
""", True)
  st.write(css, unsafe_allow_html=True)
  st.markdown("""<div class='overlay'></div>""", True)
#   st.markdown("""<img class='my-image' src="https://blog.qburst.com/wp-content/uploads/2020/09/Conversational-AI-Chatbot-Architecture-Overview.png" />""", True)
  st.image("1.png")
  PDFS = st.file_uploader("Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§ØªÙƒ Ù…Ù† Ù‡Ù†Ø§", type="pdf", accept_multiple_files=True)
  if PDFS:
    with st.spinner("â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©... "):
      #Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ PDF
      GET_TEXT = GET_TEXT_FROM_PDF(PDFS)

      st.session_state.context = GET_TEXT

      # ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¹Ù„ÙŠ Ø´ÙƒÙ„ Ù…Ù‚Ø§Ø·Ø¹
      SPLIT_TEXT_TO_CHUNK = SPLITTEXTTOCHUNK(GET_TEXT)
      for PDF in PDFS:
        filename = os.path.splitext(PDF.name)[0]
        STORE = CREATESTORE(SPLIT_TEXT_TO_CHUNK, filename)
      # Ø§Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª
    # Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    st.markdown(f"""
            <div style='background-color:#FFF1; font-size:18px ;color:#FFF; direction: rtl ;  font-family:tajawal ;padding:10px; border-radius:10px; margin-top:10px;'>
                        <span style='color:#4CAF50; margin-bottom: 6px; display:inline-block; font-weight:bold'>ğŸ‘¨â€âš–ï¸ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ</span><br>Ø£Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§ Ø¨Ùƒ Ø§Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ,  ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø¤Ø§Ù„ÙŠ Ø¹Ù† Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ ÙˆØ§Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø§Ù„ÙÙˆØ±....
                        </div>
    """, unsafe_allow_html=True)

    # Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    user_question = st.chat_input("Ø£Ø³Ø§Ù„ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§")
    if (user_question):

        answer = ASK_PDF_QUESTION(STORE, user_question)
        st.session_state.chat_history.append({
            "question": user_question ,
            "answer": answer
        })
        if st.session_state.chat_history:
            for chat in st.session_state.chat_history:
              # ğŸ”¹ ÙŠØ­ÙˆÙ„ Ø£ÙŠ Ù„ÙŠÙ†Ùƒ Ù†ØµÙŠ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· HTML Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¶ØºØ·
              def make_links_clickable(text):
                # ÙŠØ­ÙˆÙ‘Ù„ Ø£ÙŠ Ù„ÙŠÙ†Ùƒ (Ø­ØªÙ‰ Ø§Ù„Ù„ÙŠ Ù…Ù† ØºÙŠØ± http) Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¶ØºØ·
                url_pattern = r'((?:https?://)?(?:www\.)?[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(?:/[^\s<>"]*)?)'
                def repl(match):
                  url = match.group(0)
                  if not url.startswith("http"):
                    url = "https://" + url
                  return f'<a href="{url}" target="_blank" style="color:#4fc3f7; text-decoration:underline;">{match.group(0)}</a> ğŸ”—'
                return re.sub(url_pattern, repl, text)


              st.markdown(f"""
        <div style='background-color:rgb(255 255 255 / 4%); backdrop-filter: blur(10px); font-size:18px ;  color:#FFF; direction: rtl ; font-family:tajawal ;padding:10px; border-radius:10px; margin-top:10px;'>
            <span style="color: #F05; margin-bottom: 6px; display:inline-block; font-weight:bold"> ğŸ™‹â€â™‚ï¸ Ø³Ø¤Ø§Ù„Ùƒ</span><br>{chat["question"]}
                    </div>
  """, unsafe_allow_html=True)
              st.markdown(f"""
            <div style='background-color:#FFF1; font-size:18px ;color:#FFF; direction: rtl ;  font-family:tajawal ;padding:10px; border-radius:10px; margin-top:10px;'>
                        <span style='color:#4CAF50; margin-bottom: 6px; display:inline-block; font-weight:bold'>ğŸ¤– Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ</span><br>{make_links_clickable(chat["answer"])}
                        </div>
  """, unsafe_allow_html=True)



if __name__ == "__main__":
  main()